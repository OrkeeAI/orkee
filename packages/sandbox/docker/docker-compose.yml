version: '3.9'

services:
  # Base image (built first)
  sandbox-base:
    image: orkee/sandbox:base
    build:
      context: .
      dockerfile: Dockerfile.base
    command: echo "Base image built"

  # Claude Code sandbox
  claude-code:
    image: orkee/sandbox:claude-code
    build:
      context: .
      dockerfile: Dockerfile.claude-code
      args:
        BASE_IMAGE: orkee/sandbox:base
    depends_on:
      - sandbox-base
    ports:
      - "8080:8080"
    volumes:
      - workspace:/workspace
      - /var/run/docker.sock:/var/run/docker.sock:ro
    environment:
      - CLAUDE_CODE_WORKSPACE=/workspace
      - CLAUDE_CODE_PORT=8080
    networks:
      - orkee-sandbox

  # Aider sandbox
  aider:
    image: orkee/sandbox:aider
    build:
      context: .
      dockerfile: Dockerfile.aider
      args:
        BASE_IMAGE: orkee/sandbox:base
    depends_on:
      - sandbox-base
    ports:
      - "8081:8080"
    volumes:
      - workspace:/workspace
    environment:
      - AIDER_WORKSPACE=/workspace
      - AIDER_PORT=8080
    networks:
      - orkee-sandbox

  # Additional agent sandboxes can be added here

volumes:
  workspace:
    driver: local

networks:
  orkee-sandbox:
    driver: bridge
    ipam:
      config:
        - subnet: 172.28.0.0/16