# Aider agent sandbox
FROM orkee/sandbox:base

# Install Aider-specific dependencies
RUN apt-get update && apt-get install -y \
    # Additional tools Aider needs
    universal-ctags \
    silversearcher-ag \
    tmux \
    screen \
    # Database clients
    postgresql-client \
    mysql-client \
    sqlite3 \
    redis-tools \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# Install Aider via pip
RUN pip3 install --no-cache-dir \
    aider-chat \
    openai \
    anthropic \
    tiktoken \
    gitpython \
    pygments \
    rich

# Install language servers for better code understanding
RUN npm install -g \
    typescript-language-server \
    vscode-langservers-extracted \
    yaml-language-server \
    dockerfile-language-server-nodejs \
    bash-language-server

# Install Python language server
RUN pip3 install --no-cache-dir \
    python-lsp-server[all] \
    pylsp-mypy \
    pylsp-black

# Set up Aider configuration
RUN mkdir -p /root/.config/aider
COPY <<EOF /root/.config/aider/aider.conf.yml
# Default Aider configuration
auto-commits: false
pretty: true
stream: true
show-diffs: true
dark-mode: true
EOF

# Environment variables for Aider
ENV AIDER_WORKSPACE=/workspace
ENV AIDER_PORT=8080
ENV AIDER_HOST=0.0.0.0
ENV AIDER_AUTO_COMMITS=false

# Expose agent communication port
EXPOSE 8080

# Start the agent server
# CMD ["python3", "/agent/aider_server.py"]
CMD ["/bin/bash", "-c", "echo 'Aider sandbox ready' && tail -f /dev/null"]